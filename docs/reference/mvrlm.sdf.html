<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Multivariate Regression — mvrlm.sdf • EdSurvey</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Multivariate Regression — mvrlm.sdf"><meta name="description" content="Fits a multivariate linear model that uses weights and variance
             estimates appropriate for the edsurvey.data.frame."><meta property="og:description" content="Fits a multivariate linear model that uses weights and variance
             estimates appropriate for the edsurvey.data.frame."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">EdSurvey</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.0.8</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/introduction.html">Introduction to Analyzing NCES Data Using EdSurvey</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/American-Institutes-for-Research/EdSurvey/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Multivariate Regression</h1>
      <small class="dont-index">Source: <a href="https://github.com/American-Institutes-for-Research/EdSurvey/blob/HEAD/R/mvrlm.sdf.R" class="external-link"><code>R/mvrlm.sdf.R</code></a></small>
      <div class="d-none name"><code>mvrlm.sdf.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Fits a multivariate linear model that uses weights and variance
             estimates appropriate for the <code>edsurvey.data.frame</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">mvrlm.sdf</span><span class="op">(</span></span>
<span>  <span class="va">formula</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  weightVar <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  relevels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  jrrIMax <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  dropOmittedLevels <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  defaultConditions <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  recode <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  returnVarEstInputs <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  estMethod <span class="op">=</span> <span class="st">"OLS"</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  omittedLevels <span class="op">=</span> <span class="fu">deprecated</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-formula">formula<a class="anchor" aria-label="anchor" href="#arg-formula"></a></dt>
<dd><p>a <code><a href="https://rdrr.io/pkg/Formula/man/Formula.html" class="external-link">Formula</a></code> for the
linear model. See <code><a href="https://rdrr.io/pkg/Formula/man/Formula.html" class="external-link">Formula</a></code>;
left-hand side variables are separated with
vertical pipes (<code>|</code>). See Examples.</p></dd>


<dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>an <code>edsurvey.data.frame</code> or an <code>edsurvey.data.frame.list</code></p></dd>


<dt id="arg-weightvar">weightVar<a class="anchor" aria-label="anchor" href="#arg-weightvar"></a></dt>
<dd><p>character indicating the weight variable to use (see Details).
The <code>weightVar</code> must be one of the weights for the
<code>edsurvey.data.frame</code>. If <code>NULL</code>, uses the default
for the <code>edsurvey.data.frame</code>.</p></dd>


<dt id="arg-relevels">relevels<a class="anchor" aria-label="anchor" href="#arg-relevels"></a></dt>
<dd><p>a list. Used to change the contrasts from the
default treatment contrasts to treatment contrasts with a chosen omitted
group (the reference group).
To do this, the user puts an element on the list with the same name as
a variable to change contrasts on
and then make the value for that list element equal to the value
that should
be the omitted group (the reference group).</p></dd>


<dt id="arg-jrrimax">jrrIMax<a class="anchor" aria-label="anchor" href="#arg-jrrimax"></a></dt>
<dd><p>a numeric value; when using the jackknife variance estimation method, the default estimation option, <code>jrrIMax=1</code>, uses the
                  sampling variance from the first plausible value as the component for sampling variance estimation. The \(V_{jrr}\)
                  term (see
<a href="https://www.air.org/sites/default/files/EdSurvey-Statistics.pdf" class="external-link"><em>Statistical Methods Used in EdSurvey</em></a>)
                  can be estimated with any number of plausible values, and values larger than the number of
                  plausible values on the survey (including <code>Inf</code>) will result in all plausible values being used.
                  Higher values of <code>jrrIMax</code> lead to longer computing times and more accurate variance estimates.</p></dd>


<dt id="arg-dropomittedlevels">dropOmittedLevels<a class="anchor" aria-label="anchor" href="#arg-dropomittedlevels"></a></dt>
<dd><p>a logical value. When set to the default value of <code>TRUE</code>, drops
those levels of all factor variables that are specified
in <code>edsurvey.data.frame</code>. Use <code>print</code> on an
<code>edsurvey.data.frame</code> to see the omitted levels.</p></dd>


<dt id="arg-defaultconditions">defaultConditions<a class="anchor" aria-label="anchor" href="#arg-defaultconditions"></a></dt>
<dd><p>a logical value. When set to the default value of <code>TRUE</code>, uses
the default conditions stored in <code>edsurvey.data.frame</code>
to subset the data. Use <code>print</code> on an
<code>edsurvey.data.frame</code> to see the default conditions.</p></dd>


<dt id="arg-recode">recode<a class="anchor" aria-label="anchor" href="#arg-recode"></a></dt>
<dd><p>a list of lists to recode variables. Defaults to <code>NULL</code>. Can be set as
<code>recode</code> <code>=</code> <code>list(var1=</code> <code>list(from=c("a","b","c"),</code> <code>to ="d"))</code>.</p></dd>


<dt id="arg-returnvarestinputs">returnVarEstInputs<a class="anchor" aria-label="anchor" href="#arg-returnvarestinputs"></a></dt>
<dd><p>a logical value. Set to <code>TRUE</code> to return the
inputs to the jackknife and imputation variance
estimates, which allow for
computation of covariances between estimates.</p></dd>


<dt id="arg-estmethod">estMethod<a class="anchor" aria-label="anchor" href="#arg-estmethod"></a></dt>
<dd><p>a character value indicating which estimation method to use.
Default is <code>OLS</code>; other option is <code>GLS</code>.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>logical; indicates whether a detailed printout should display during execution</p></dd>


<dt id="arg-omittedlevels">omittedLevels<a class="anchor" aria-label="anchor" href="#arg-omittedlevels"></a></dt>
<dd><p>this argument is deprecated. Use <code>dropOmittedLevels</code></p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An <code>edsurvey.mvrlm</code> with elements:</p>
<dl><dt>call</dt>
<dd><p>the function call</p></dd>

   <dt>formula</dt>
<dd><p>the formula used to fit the model</p></dd>

   <dt>coef</dt>
<dd><p>the estimates of the coefficients</p></dd>

   <dt>se</dt>
<dd><p>the standard error estimates of the coefficients</p></dd>

   <dt>Vimp</dt>
<dd><p>the estimated variance caused by uncertainty in the scores (plausible value variables)</p></dd>

   <dt>Vjrr</dt>
<dd><p>the estimated variance caused by sampling</p></dd>

   <dt>M</dt>
<dd><p>the number of plausible values</p></dd>

   <dt>varm</dt>
<dd><p>the variance estimates under the various plausible values</p></dd>

   <dt>coefm</dt>
<dd><p>the values of the coefficients under the various plausible values</p></dd>

   <dt>coefmat</dt>
<dd><p>the coefficient matrix (typically produced by the summary of a model)</p></dd>

   <dt>r.squared</dt>
<dd><p>the coefficient of determination</p></dd>

   <dt>weight</dt>
<dd><p>the name of the weight variable</p></dd>

   <dt>npv</dt>
<dd><p>the number of plausible values</p></dd>

   <dt>njk</dt>
<dd><p>the number of the jackknife replicates used</p></dd>

   <dt>varEstInputs</dt>
<dd><p>When <code>returnVarEstInputs</code> is <code>TRUE</code>,
                       this element is returned. These are
                       used for calculating covariances with
                       <code><a href="varEstToCov.html">varEstToCov</a></code>.</p></dd>

   <dt>residuals</dt>
<dd><p>residuals for each of the PV models</p></dd>

   <dt>fitted.values</dt>
<dd><p>model fitted values</p></dd>

   <dt>residCov</dt>
<dd><p>residual covariance matrix for dependent variables</p></dd>

   <dt>residPV</dt>
<dd><p>residuals for each dependent variable</p></dd>

   <dt>inputs</dt>
<dd><p>coefficient estimation input matrices</p></dd>

   <dt>n0</dt>
<dd><p>full data <em>n</em></p></dd>

   <dt>nUsed</dt>
<dd><p><em>n</em> used for model</p></dd>

   <dt>B</dt>
<dd><p>imputation variance-covariance matrix, before multiplication by (M+1)/M</p></dd>

   <dt>U</dt>
<dd><p>sampling variance-covariance matrix</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function implements an estimator that correctly handles multiple left-hand
side variables that are either numeric or plausible values, allows for survey
sampling weights, and estimates variances using the jackknife replication method.
The vignette titled
<a href="https://www.air.org/sites/default/files/EdSurvey-Statistics.pdf" class="external-link"><em>Statistical Methods Used in EdSurvey</em></a>
describes estimation of the reported statistics.</p>
<p>The <b>coefficients</b> are estimated using the sample weights according to the section
“Estimation of Weighted Means When Plausible Values Are Not Present”
or the section
“Estimation of Weighted Means When Plausible Values Are Present,”
depending on if there are assessment variables or variables with plausible values in them.</p>
<p>The <b>coefficient of determination (R-squared value)</b> is similarly estimated by finding
the average R-squared using the sample weights for each set of plausible values.</p>
<div class="section">
<h3 id="variance-estimation-of-coefficients">Variance estimation of coefficients<a class="anchor" aria-label="anchor" href="#variance-estimation-of-coefficients"></a></h3>
<p>All variance estimation methods are shown in the vignette titled
  <a href="https://www.air.org/sites/default/files/EdSurvey-Statistics.pdf" class="external-link"><em>Statistical Methods Used in EdSurvey</em></a>.</p>
<p>When the predicted value does not have plausible values, the variance of the coefficients
  is estimated according to the section “Estimation of Standard Errors
  of Weighted Means When Plausible Values Are Not Present, Using the Jackknife Method.”</p>
<p>When plausible values are present, the variance of the coefficients is estimated according to the section
“Estimation of Standard Errors of Weighted Means When
        Plausible Values Are Present, Using the Jackknife Method.”</p>
</div>

<p>For more information on the specifics of multivariate regression, see the vignette titled
<a href="https://www.air.org/sites/default/files/EdSurvey-Multivariate_Regression.pdf" class="external-link">Methods and Overview of Using EdSurvey for Multivariate Regression</a>.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></code>, <code><a href="lm.sdf.html">lm.sdf</a></code></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Alex Lishinski and Paul Bailey</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># read in the example data (generated, not real student data)</span></span></span>
<span class="r-in"><span><span class="va">sdf</span> <span class="op">&lt;-</span> <span class="fu"><a href="readNAEP.html">readNAEP</a></span><span class="op">(</span>path<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/data"</span>, <span class="st">"M36NT2PM.dat"</span>, package <span class="op">=</span> <span class="st">"NAEPprimer"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># use | symbol to separate dependent variables in the left-hand side of formula</span></span></span>
<span class="r-in"><span><span class="va">mvrlm.fit</span> <span class="op">&lt;-</span> <span class="fu">mvrlm.sdf</span><span class="op">(</span>formula<span class="op">=</span><span class="va">algebra</span> <span class="op">|</span> <span class="va">geometry</span> <span class="op">~</span> <span class="va">dsex</span> <span class="op">+</span> <span class="va">m072801</span>, jrrIMax <span class="op">=</span> <span class="fl">5</span>, data <span class="op">=</span> <span class="va">sdf</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># print method returns coefficients, as does coef method</span></span></span>
<span class="r-in"><span><span class="va">mvrlm.fit</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">mvrlm.fit</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># for more detailed results, use summary:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mvrlm.fit</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># details of model can also be accessed through components of the returned object; for example:</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># coefficients (one column per dependent variable)</span></span></span>
<span class="r-in"><span><span class="va">mvrlm.fit</span><span class="op">$</span><span class="va">coef</span></span></span>
<span class="r-in"><span><span class="co"># coefficient table with standard errors and p-values (1 table per dependent variable)</span></span></span>
<span class="r-in"><span><span class="va">mvrlm.fit</span><span class="op">$</span><span class="va">coefmat</span></span></span>
<span class="r-in"><span><span class="co"># R-squared values (one per dependent variable)</span></span></span>
<span class="r-in"><span><span class="va">mvrlm.fit</span><span class="op">$</span><span class="va">r.squared</span></span></span>
<span class="r-in"><span><span class="co"># residual covariance matrix</span></span></span>
<span class="r-in"><span><span class="va">mvrlm.fit</span><span class="op">$</span><span class="va">residCov</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># dependent variables can have plausible values or not (or a combination)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">mvrlm.fit</span> <span class="op">&lt;-</span> <span class="fu">mvrlm.sdf</span><span class="op">(</span>formula<span class="op">=</span><span class="va">composite</span> <span class="op">|</span> <span class="va">mrps22</span> <span class="op">~</span> <span class="va">dsex</span> <span class="op">+</span> <span class="va">m072801</span>, data <span class="op">=</span> <span class="va">sdf</span>, jrrIMax <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mvrlm.fit</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">mvrlm.fit</span> <span class="op">&lt;-</span> <span class="fu">mvrlm.sdf</span><span class="op">(</span>formula<span class="op">=</span><span class="va">algebra</span> <span class="op">|</span> <span class="va">geometry</span> <span class="op">|</span> <span class="va">measurement</span> <span class="op">~</span> <span class="va">dsex</span> <span class="op">+</span> <span class="va">m072801</span>,</span></span>
<span class="r-in"><span>                     data <span class="op">=</span> <span class="va">sdf</span>, jrrIMax <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mvrlm.fit</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">mvrlm.fit</span> <span class="op">&lt;-</span> <span class="fu">mvrlm.sdf</span><span class="op">(</span>formula<span class="op">=</span><span class="va">mrps51</span> <span class="op">|</span> <span class="va">mrps22</span> <span class="op">~</span> <span class="va">dsex</span> <span class="op">+</span> <span class="va">m072801</span>, data <span class="op">=</span> <span class="va">sdf</span>, jrrIMax <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mvrlm.fit</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># hypotheses about coefficient restrictions can also be tested using the Wald test</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">mvr</span> <span class="op">&lt;-</span> <span class="fu">mvrlm.sdf</span><span class="op">(</span>formula<span class="op">=</span><span class="va">algebra</span> <span class="op">|</span> <span class="va">geometry</span> <span class="op">~</span> <span class="va">dsex</span> <span class="op">+</span> <span class="va">m072801</span>, data <span class="op">=</span> <span class="va">sdf</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">hypothesis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"geometry_dsexFemale = 0"</span>, <span class="st">"algebra_dsexFemale = 0"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># test statistics based on the F and chi-squared distribution are available</span></span></span>
<span class="r-in"><span><span class="fu">linearHypothesis</span><span class="op">(</span>model<span class="op">=</span><span class="va">mvr</span>, hypothesis <span class="op">=</span> <span class="va">hypothesis</span>, test <span class="op">=</span> <span class="st">"F"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">linearHypothesis</span><span class="op">(</span>model<span class="op">=</span><span class="va">mvr</span>, hypothesis <span class="op">=</span> <span class="va">hypothesis</span>, test <span class="op">=</span> <span class="st">"Chisq"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Paul Bailey, Ahmad Emad, Huade Huo, Michael Lee, Yuqi Liao, Alex Lishinski, Trang Nguyen, Qingshu Xie, Jiao Yu, Ting Zhang, Eric Buehler, Sun-joo Lee, Blue Webb, Thomas Fink, Sinan Yavuz.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

